(function(e){function t(t){for(var i,o,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(p.length)p.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={app:0},r=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[n("div",{staticClass:"d-flex align-center"},[e._v(" PoseNet people counter ")])]),n("v-content",[n("Camera")],1)],1)},r=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-container",{attrs:{fluid:""}},[n("v-row",{attrs:{dense:""}},[n("v-col",[n("div",{staticStyle:{display:"none"},attrs:{id:"info"}}),n("div",{attrs:{id:"loading"}},[e._v(" Loading the model... ")]),n("div",{staticStyle:{display:"none"},attrs:{id:"main"}},[n("video",{staticStyle:{display:"none"},attrs:{id:"video",playsinline:""}}),n("canvas",{attrs:{id:"output"}})])]),n("v-col",[n("v-card",{staticClass:"mx-auto",attrs:{outlined:"",align:"left"}},[n("v-list-item",{attrs:{"three-line":""}},[n("v-list-item-content",[n("div",{staticClass:"overline mb-4"},[e._v("count")]),n("v-list-item-title",{staticClass:"headline mb-1"},[n("v-icon",{attrs:{large:""}},[e._v("mdi-walk")]),e._v(e._s(e.people_count))],1),n("v-list-item-subtitle",[e._v("Count from "+e._s(e.last_reset))])],1)],1),n("v-card-actions",[n("v-btn",{on:{click:e.clear_count}},[e._v("Reset")])],1)],1),n("v-card",[n("v-expansion-panels",[n("v-expansion-panel",[n("v-expansion-panel-header",[e._v("Detect line width")]),n("v-expansion-panel-content",[n("v-slider",{attrs:{min:"0",max:"100",label:"width"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{suffix:"px","hide-details":"","single-line":"",type:"number"},model:{value:e.thresh,callback:function(t){e.thresh=t},expression:"thresh"}})]},proxy:!0}]),model:{value:e.thresh,callback:function(t){e.thresh=t},expression:"thresh"}})],1)],1),n("v-expansion-panel",[n("v-expansion-panel-header",[e._v("Move detect line")]),n("v-expansion-panel-content",[n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"800",label:"p1_x"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p1.x,callback:function(t){e.$set(e.p1,"x",t)},expression:"p1.x"}})]},proxy:!0}]),model:{value:e.p1.x,callback:function(t){e.$set(e.p1,"x",t)},expression:"p1.x"}})],1),n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"600",label:"p1_y"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p1.y,callback:function(t){e.$set(e.p1,"y",t)},expression:"p1.y"}})]},proxy:!0}]),model:{value:e.p1.y,callback:function(t){e.$set(e.p1,"y",t)},expression:"p1.y"}})],1),n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"800",label:"p2_x"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p2.x,callback:function(t){e.$set(e.p2,"x",t)},expression:"p2.x"}})]},proxy:!0}]),model:{value:e.p2.x,callback:function(t){e.$set(e.p2,"x",t)},expression:"p2.x"}})],1),n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"600",label:"p2_y"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p2.y,callback:function(t){e.$set(e.p2,"y",t)},expression:"p2.y"}})]},proxy:!0}]),model:{value:e.p2.y,callback:function(t){e.$set(e.p2,"y",t)},expression:"p2.y"}})],1)],1)],1)],1)],1)],1)],1)],1)],1)},s=[],l=(n("cb29"),n("4de4"),n("4160"),n("d3b7"),n("159b"),n("96cf"),n("1da1")),c=n("8726"),u=n("3191"),d=n.n(u),p=(n("ddb0"),n("3835")),f=n("0b53"),m={getName:function(){return""},color:"aqua",lineWidth:2,toTuple:function(e){return[e.y,e.x]},drawPoint:function(e,t,n,i){e.beginPath(),e.arc(n,t,i,0,2*Math.PI),e.fillStyle="pink",e.fill()},drawSegment:function(e,t,n,i,a){a.beginPath(),a.moveTo(e[1]*i,e[0]*i),a.lineTo(t[1]*i,t[0]*i),a.lineWidth=5,a.strokeStyle=n,a.stroke()},drawSkeleton:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=c["a"](e,t);r.forEach((function(e){i.drawSegment(i.toTuple(e[0].position),i.toTuple(e[1].position),"pink",a,n)}))},drawKeypoints:function(e,t,n,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=0;r<e.length;r++){var o=e[r];if(!(o.score<t)){var s=o.position,l=s.y,c=s.x;this.drawPoint(n,l*a,c*a,2,i)}}},drawBoundingBox:function(e,t){var n=c["b"](e);t.rect(n.minX,n.minY,n.maxX-n.minX,n.maxY-n.minY),t.stroke()},renderToCanvas:function(e,t){return Object(l["a"])(regeneratorRuntime.mark((function n(){var i,a,r,o,s,l,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=Object(p["a"])(e.shape,2),a=i[0],r=i[1],o=new ImageData(r,a),n.next=4,e.data();case 4:for(s=n.sent,l=0;l<a*r;++l)c=4*l,u=3*l,o.data[c]=s[u],o.data[c+1]=s[u+1],o.data[c+2]=s[u+2],o.data[c+3]=255;t.putImageData(o,0,0);case 7:case"end":return n.stop()}}),n)})))()},renderImageToCanvas:function(e,t,n){n.width=t[0],n.height=t[1]},drawHeatMapValues:function(e,t,n,i){var a=n.getContext("2d"),r=5,o=e.mul(f["a"](t,"int32"));this.drawPoints(a,o,r,i)},drawPoints:function(e,t,n,i){for(var a=t.buffer().values,r=0;r<a.length;r+=2){var o=a[r],s=a[r+1];0!==s&&0!==o&&(e.beginPath(),e.arc(s,o,n,0,2*Math.PI),e.fillStyle=i,e.fill())}},drawOffsetVectors:function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,o=c["singlePose"].getOffsetPoints(e,n,t),s=e.buffer().values,l=o.buffer().values,u=0;u<s.length;u+=2){var d=s[u]*n,p=s[u+1]*n,f=l[u],m=l[u+1];this.drawSegment([d,p],[f,m],r,i,a)}},drawOffsetVector:function(e,t,n,i,a,r){this.drawSegment([t*i,n*i],[t*i+a,n*i+r],"red",1,e)},drawDisplacementEdgesFrom:function(e,t,n,i,a,r,o,s,l){var c=this,u=n.shape[2]/2,d=o*i+l,p=r*i+s,f=a[t]||[];f.length>0&&f.forEach((function(t){var i=n.get(r,o,t),a=n.get(r,o,t+u);c.drawSegment([p,d],[p+i,d+a],"blue",1,e)}))}},v=800,h=600,x=new d.a,y={algorithm:"multi-pose",input:{mobileNetArchitecture:"0.75",outputStride:16,imageScaleFactor:.5},singlePoseDetection:{minPoseConfidence:.1,minPartConfidence:.5},multiPoseDetection:{maxPoseDetections:5,minPoseConfidence:.15,minPartConfidence:.1,nmsRadius:30},output:{showVideo:!0,showSkeleton:!0,showPoints:!0},net:null},g={name:"Camera",data:function(){return{is_rear_camera:!0,people_count:0,p1:{x:400,y:0},p2:{x:400,y:600},thresh:10,last_reset:"",prev_detected:{x:-1,y:-1,on:null}}},mounted:function(){this.onMounted()},methods:{clear_count:function(){this.last_reset=(new Date).toLocaleString(),this.people_count=0},detectPoseInRealTime:function(e,t){var n=this;console.log(t);var i,a=document.getElementById("output"),r=a.getContext("2d");function o(){return s.apply(this,arguments)}function s(){return s=Object(l["a"])(regeneratorRuntime.mark((function t(){var a,s,l,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!y.changeToArchitecture){t.next=6;break}return y.net.dispose(),t.next=4,c["c"](+y.changeToArchitecture);case 4:y.net=t.sent,y.changeToArchitecture=null;case 6:x.begin(),a=null,s=[],d="red",t.t0=y.algorithm,t.next="single-pose"===t.t0?13:"multi-pose"===t.t0?20:26;break;case 13:return t.next=15,y.net.estimatePoses(e,{flipHorizontal:i,decodingMethod:"single-person"});case 15:return a=t.sent,s.push(a),l=+y.singlePoseDetection.minPoseConfidence,u=+y.singlePoseDetection.minPartConfidence,t.abrupt("break",26);case 20:return t.next=22,y.net.estimatePoses(e,{flipHorizontal:i,decodingMethod:"multi-person",maxDetections:y.multiPoseDetection.maxPoseDetections,scoreThreshold:y.multiPoseDetection.minPartConfidence,nmsRadius:y.multiPoseDetection.nmsRadius});case 22:return s=t.sent,l=+y.multiPoseDetection.minPoseConfidence,u=+y.multiPoseDetection.minPartConfidence,t.abrupt("break",26);case 26:r.clearRect(0,0,v,h),y.output.showVideo&&(r.save(),r.drawImage(e,0,0,v,h),r.restore()),s.forEach((function(e){var t=e.score,i=e.keypoints;if(t>=l){console.log(JSON.stringify(i),u,r),y.output.showPoints&&m.drawKeypoints(i,u,r),y.output.showSkeleton&&m.drawSkeleton(i,u,r);var a=i.filter((function(e){return"leftShoulder"===e.part}))[0],o=i.filter((function(e){return"rightShoulder"===e.part}))[0],s=function(e,t,n,i){var a=(e.x-t.x)*(n.y-e.y)+(e.y-t.y)*(e.x-n.x),r=(e.x-t.x)*(i.y-e.y)+(e.y-t.y)*(e.x-i.x),o=(n.x-i.x)*(e.y-n.y)+(n.y-i.y)*(n.x-e.x),s=(n.x-i.x)*(t.y-n.y)+(n.y-i.y)*(n.x-t.x);return a*r<0&&o*s<0},c=function(e,t,n,i,a,r){var o=a-n,s=r-i,l=o*o,c=s*s,u=l+c,d=-(o*(n-e)+s*(i-t));if(d<0)return(n-e)*(n-e)+(i-t)*(i-t);if(d>u)return(a-e)*(a-e)+(r-t)*(r-t);var p=o*(i-t)-s*(n-e);return p*p/u},p={x:n.p1.x,y:n.p1.y},f={x:n.p2.x,y:n.p2.y},v=a.position,h=o.position,x=(v.x+h.x)/2,g=(v.y+h.y)/2;if(r.beginPath(),r.arc(x,g,2,0,2*Math.PI),r.fillStyle="green",r.fill(),s(p,f,v,h)){var b="aqua";c(x,g,n.p1.x,n.p1.y,n.p2.x,n.p2.y)<=n.thresh&&(new Date).getTime()-n.prev_detected.on>=300&&(d="yellow",n.people_count++,n.prev_detected={x:x,y:g,on:(new Date).getTime()},b="orange",r.beginPath(),r.arc(x,g,30,0,2*Math.PI),r.fillStyle="red",r.fill()),r.beginPath(),r.moveTo(v.x,v.y),r.lineTo(h.x,h.y),r.lineWidth=4,r.strokeStyle=b,r.stroke()}}})),r.beginPath(),r.moveTo(n.p1.x,n.p1.y),r.lineTo(n.p2.x,n.p2.y),r.lineWidth=n.thresh,r.strokeStyle=d,r.stroke(),r.font="bold 20px sans-serif",r.fillStyle=d,r.fillText("p1",n.p1.x+n.thresh+5,n.p1.y+20),r.fillText("p2",n.p2.x+n.thresh+5,n.p2.y-15),x.end(),requestAnimationFrame(o);case 41:case"end":return t.stop()}}),t)}))),s.apply(this,arguments)}i=!1,a.width=v,a.height=h,o()},setupCamera:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){t.next=2;break}throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");case 2:return n=document.getElementById("video"),n.width=v,n.height=h,a=e.isMobile(),i=a?{exact:"environment"}:"user",t.next=9,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:i,width:a?void 0:v,height:a?void 0:h}});case 9:return r=t.sent,n.srcObject=r,t.abrupt("return",new Promise((function(e){n.onloadedmetadata=function(){e(n)}})));case 12:case"end":return t.stop()}}),t)})))()},loadVideo:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.setupCamera();case 2:return n=t.sent,n.play(),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()},setupFPS:function(){x.showPanel(0),document.body.appendChild(x.dom)},setupGui:function(e,t){y.net=t,e.length>0&&(y.camera=e[0].deviceId)},onMounted:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["c"]();case 2:return n=t.sent,document.getElementById("loading").style.display="none",document.getElementById("main").style.display="block",t.prev=5,t.next=8,e.loadVideo();case 8:i=t.sent,t.next=17;break;case 11:throw t.prev=11,t.t0=t["catch"](5),a=document.getElementById("info"),a.textContent="this browser does not support video capture,or this device does not have a camera",a.style.display="block",t.t0;case 17:e.setupGui([],n),e.prev_detected.on=(new Date).getTime(),e.last_reset=(new Date).toLocaleString(),e.detectPoseInRealTime(i,n);case 21:case"end":return t.stop()}}),t,null,[[5,11]])})))()},isAndroid:function(){return/Android/i.test(navigator.userAgent)},isiOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},isMobile:function(){return this.isAndroid()||this.isiOS()}}},b=g,w=n("2877"),P=n("6544"),k=n.n(P),S=n("8336"),_=n("b0af"),C=n("99d9"),T=n("62ad"),V=n("a523"),O=n("cd55"),D=n("49e2"),I=n("c865"),M=n("0393"),j=n("132d"),R=n("da13"),E=n("5d23"),A=n("0fd9"),$=n("ba0d"),B=n("8654"),L=Object(w["a"])(b,o,s,!1,null,null,null),F=L.exports;k()(L,{VBtn:S["a"],VCard:_["a"],VCardActions:C["a"],VCol:T["a"],VContainer:V["a"],VExpansionPanel:O["a"],VExpansionPanelContent:D["a"],VExpansionPanelHeader:I["a"],VExpansionPanels:M["a"],VIcon:j["a"],VListItem:R["a"],VListItemContent:E["a"],VListItemSubtitle:E["b"],VListItemTitle:E["c"],VRow:A["a"],VSlider:$["a"],VTextField:B["a"]});var H={name:"App",components:{Camera:F},data:function(){return{drawer:!1}}},N=H,W=n("7496"),q=n("40dc"),J=n("a75b"),U=Object(w["a"])(N,a,r,!1,null,null,null),X=U.exports;k()(U,{VApp:W["a"],VAppBar:q["a"],VContent:J["a"]});var Y=n("f309");i["a"].use(Y["a"]);var z=new Y["a"]({});i["a"].config.productionTip=!1,new i["a"]({vuetify:z,render:function(e){return e(X)}}).$mount("#app")},6:function(e,t){}});
//# sourceMappingURL=app.166cf548.js.map