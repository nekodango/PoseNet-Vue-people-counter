(function(e){function t(t){for(var i,r,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(p.length)p.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(i=!1)}i&&(o.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},a={app:0},o=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[n("div",{staticClass:"d-flex align-center"},[e._v(" PoseNet people counter ")])]),n("v-content",[n("Camera")],1)],1)},o=[],r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-container",{attrs:{fluid:""}},[n("v-row",{attrs:{dense:""}},[n("v-col",[n("div",{staticStyle:{display:"none"},attrs:{id:"info"}}),n("div",{attrs:{id:"loading"}},[e._v(" Loading the model... ")]),n("v-card",[n("div",{staticStyle:{display:"none"},attrs:{id:"main"}},[n("video",{staticStyle:{display:"none"},attrs:{id:"video",playsinline:""}}),n("canvas",{attrs:{id:"output"}})])])],1),n("v-col",[n("v-card",{staticClass:"mx-auto",attrs:{outlined:"",align:"left"}},[n("v-list-item",{attrs:{"three-line":""}},[n("v-list-item-content",[n("div",{staticClass:"overline mb-4"},[e._v("count")]),n("v-list-item-title",{staticClass:"headline mb-1"},[n("v-icon",{attrs:{large:""}},[e._v("mdi-walk")]),e._v(e._s(e.people_count))],1),n("v-list-item-subtitle",[e._v("Count from "+e._s(e.last_reset))])],1)],1),n("v-card-actions",[n("v-btn",{on:{click:e.clear_count}},[e._v("Reset")])],1)],1),n("v-card",[n("v-expansion-panels",{model:{value:e.panel,callback:function(t){e.panel=t},expression:"panel"}},[n("v-expansion-panel",[n("v-expansion-panel-header",[e._v("Camera")]),n("v-expansion-panel-content",[n("v-select",{attrs:{items:e.cameras,"item-text":"label","item-value":"deviceId",label:"camera","return-object":""},on:{change:e.startCount},model:{value:e.selected_camera,callback:function(t){e.selected_camera=t},expression:"selected_camera"}})],1)],1),n("v-expansion-panel",[n("v-expansion-panel-header",[e._v("Detection Keypoints")]),n("v-expansion-panel-content",[n("v-select",{attrs:{items:e.keypoints,label:"#1","return-object":""},model:{value:e.selected_keypoints.k1,callback:function(t){e.$set(e.selected_keypoints,"k1",t)},expression:"selected_keypoints.k1"}}),n("v-select",{attrs:{items:e.keypoints,label:"#2","return-object":""},model:{value:e.selected_keypoints.k2,callback:function(t){e.$set(e.selected_keypoints,"k2",t)},expression:"selected_keypoints.k2"}})],1)],1),n("v-expansion-panel",[n("v-expansion-panel-header",[e._v("Max Pose Detections")]),n("v-expansion-panel-content",[n("v-slider",{attrs:{min:"0",max:"50",label:"Max Pose Detections"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.maxPoseDetections,callback:function(t){e.maxPoseDetections=t},expression:"maxPoseDetections"}})]},proxy:!0}]),model:{value:e.maxPoseDetections,callback:function(t){e.maxPoseDetections=t},expression:"maxPoseDetections"}})],1)],1),n("v-expansion-panel",[n("v-expansion-panel-header",[e._v("Detect line width")]),n("v-expansion-panel-content",[n("v-slider",{attrs:{min:"0",max:"100",label:"width"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{suffix:"px","hide-details":"","single-line":"",type:"number"},model:{value:e.thresh,callback:function(t){e.thresh=t},expression:"thresh"}})]},proxy:!0}]),model:{value:e.thresh,callback:function(t){e.thresh=t},expression:"thresh"}})],1)],1),n("v-expansion-panel",[n("v-expansion-panel-header",[e._v("Move detect line")]),n("v-expansion-panel-content",[n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"800",label:"p1_x"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p1.x,callback:function(t){e.$set(e.p1,"x",t)},expression:"p1.x"}})]},proxy:!0}]),model:{value:e.p1.x,callback:function(t){e.$set(e.p1,"x",t)},expression:"p1.x"}})],1),n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"600",label:"p1_y"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p1.y,callback:function(t){e.$set(e.p1,"y",t)},expression:"p1.y"}})]},proxy:!0}]),model:{value:e.p1.y,callback:function(t){e.$set(e.p1,"y",t)},expression:"p1.y"}})],1),n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"800",label:"p2_x"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p2.x,callback:function(t){e.$set(e.p2,"x",t)},expression:"p2.x"}})]},proxy:!0}]),model:{value:e.p2.x,callback:function(t){e.$set(e.p2,"x",t)},expression:"p2.x"}})],1),n("v-list-item",[n("v-slider",{attrs:{min:"0",max:"600",label:"p2_y"},scopedSlots:e._u([{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number"},model:{value:e.p2.y,callback:function(t){e.$set(e.p2,"y",t)},expression:"p2.y"}})]},proxy:!0}]),model:{value:e.p2.y,callback:function(t){e.$set(e.p2,"y",t)},expression:"p2.y"}})],1)],1)],1)],1)],1)],1)],1)],1)],1)},s=[],l=(n("cb29"),n("4de4"),n("4160"),n("d3b7"),n("159b"),n("96cf"),n("1da1")),c=n("8726"),u=n("3191"),d=n.n(u),p=(n("ddb0"),n("3835")),f=n("0b53"),m={getName:function(){return""},color:"aqua",lineWidth:2,toTuple:function(e){return[e.y,e.x]},drawPoint:function(e,t,n,i){e.beginPath(),e.arc(n,t,i,0,2*Math.PI),e.fillStyle="pink",e.fill()},drawSegment:function(e,t,n,i,a){a.beginPath(),a.moveTo(e[1]*i,e[0]*i),a.lineTo(t[1]*i,t[0]*i),a.lineWidth=5,a.strokeStyle=n,a.stroke()},drawSkeleton:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=c["a"](e,t);o.forEach((function(e){i.drawSegment(i.toTuple(e[0].position),i.toTuple(e[1].position),"pink",a,n)}))},drawKeypoints:function(e,t,n,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=0;o<e.length;o++){var r=e[o];if(!(r.score<t)){var s=r.position,l=s.y,c=s.x;this.drawPoint(n,l*a,c*a,2,i)}}},drawBoundingBox:function(e,t){var n=c["b"](e);t.rect(n.minX,n.minY,n.maxX-n.minX,n.maxY-n.minY),t.stroke()},renderToCanvas:function(e,t){return Object(l["a"])(regeneratorRuntime.mark((function n(){var i,a,o,r,s,l,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=Object(p["a"])(e.shape,2),a=i[0],o=i[1],r=new ImageData(o,a),n.next=4,e.data();case 4:for(s=n.sent,l=0;l<a*o;++l)c=4*l,u=3*l,r.data[c]=s[u],r.data[c+1]=s[u+1],r.data[c+2]=s[u+2],r.data[c+3]=255;t.putImageData(r,0,0);case 7:case"end":return n.stop()}}),n)})))()},renderImageToCanvas:function(e,t,n){n.width=t[0],n.height=t[1]},drawHeatMapValues:function(e,t,n,i){var a=n.getContext("2d"),o=5,r=e.mul(f["a"](t,"int32"));this.drawPoints(a,r,o,i)},drawPoints:function(e,t,n,i){for(var a=t.buffer().values,o=0;o<a.length;o+=2){var r=a[o],s=a[o+1];0!==s&&0!==r&&(e.beginPath(),e.arc(s,r,n,0,2*Math.PI),e.fillStyle=i,e.fill())}},drawOffsetVectors:function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,r=c["singlePose"].getOffsetPoints(e,n,t),s=e.buffer().values,l=r.buffer().values,u=0;u<s.length;u+=2){var d=s[u]*n,p=s[u+1]*n,f=l[u],m=l[u+1];this.drawSegment([d,p],[f,m],o,i,a)}},drawOffsetVector:function(e,t,n,i,a,o){this.drawSegment([t*i,n*i],[t*i+a,n*i+o],"red",1,e)},drawDisplacementEdgesFrom:function(e,t,n,i,a,o,r,s,l){var c=this,u=n.shape[2]/2,d=r*i+l,p=o*i+s,f=a[t]||[];f.length>0&&f.forEach((function(t){var i=n.get(o,r,t),a=n.get(o,r,t+u);c.drawSegment([p,d],[p+i,d+a],"blue",1,e)}))}},v=800,h=600,x=new d.a,y={algorithm:"multi-pose",input:{mobileNetArchitecture:"0.75",outputStride:16,imageScaleFactor:.5},singlePoseDetection:{minPoseConfidence:.1,minPartConfidence:.5},multiPoseDetection:{minPoseConfidence:.15,minPartConfidence:.1,nmsRadius:30},output:{showVideo:!0,showSkeleton:!0,showPoints:!0},net:null},g={name:"Camera",data:function(){return{is_rear_camera:!0,people_count:0,p1:{x:0,y:300},p2:{x:800,y:300},thresh:10,last_reset:"",prev_detected:{x:-1,y:-1,on:null},maxPoseDetections:10,panel:[],keypoints:["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],selected_keypoints:{k1:"leftShoulder",k2:"rightAnkle"},cameras:[],selected_camera:null,video:null}},computed:{is_editing_detectline:function(){return 4===this.panel}},mounted:function(){this.onMounted()},methods:{startCount:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["c"]();case 2:return t=e.sent,document.getElementById("loading").style.display="none",document.getElementById("main").style.display="block",e.prev=5,e.next=8,this.loadVideo(this.selected_camera.deviceId);case 8:this.video=e.sent,e.next=17;break;case 11:throw e.prev=11,e.t0=e["catch"](5),n=document.getElementById("info"),n.textContent="this browser does not support video capture,or this device does not have a camera",n.style.display="block",e.t0;case 17:this.setupGui([],t),this.detectPoseInRealTime(this.video,t);case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));function t(){return e.apply(this,arguments)}return t}(),clear_count:function(){this.last_reset=(new Date).toLocaleString(),this.people_count=0},detectPoseInRealTime:function(e,t){var n=this;console.log(t);var i,a=document.getElementById("output"),o=a.getContext("2d");function r(){return s.apply(this,arguments)}function s(){return s=Object(l["a"])(regeneratorRuntime.mark((function t(){var a,s,l,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!y.changeToArchitecture){t.next=6;break}return y.net.dispose(),t.next=4,c["c"]({architecture:"MobileNetV1"});case 4:y.net=t.sent,y.changeToArchitecture=null;case 6:x.begin(),a=null,s=[],d="red",t.t0=y.algorithm,t.next="single-pose"===t.t0?13:"multi-pose"===t.t0?20:26;break;case 13:return t.next=15,y.net.estimatePoses(e,{flipHorizontal:i,decodingMethod:"single-person"});case 15:return a=t.sent,s.push(a),l=+y.singlePoseDetection.minPoseConfidence,u=+y.singlePoseDetection.minPartConfidence,t.abrupt("break",26);case 20:return t.next=22,y.net.estimatePoses(e,{flipHorizontal:i,decodingMethod:"multi-person",maxDetections:n.maxPoseDetections,scoreThreshold:y.multiPoseDetection.minPartConfidence,nmsRadius:y.multiPoseDetection.nmsRadius});case 22:return s=t.sent,l=+y.multiPoseDetection.minPoseConfidence,u=+y.multiPoseDetection.minPartConfidence,t.abrupt("break",26);case 26:o.clearRect(0,0,v,h),y.output.showVideo&&(o.save(),o.drawImage(e,0,0,v,h),o.restore()),s.forEach((function(e){var t=e.score,i=e.keypoints;if(t>=l){console.log(JSON.stringify(i),u,o),y.output.showPoints&&m.drawKeypoints(i,u,o),y.output.showSkeleton&&m.drawSkeleton(i,u,o);var a=i.filter((function(e){return e.part===n.selected_keypoints.k1}))[0],r=i.filter((function(e){return e.part===n.selected_keypoints.k2}))[0],s=function(e,t,n,i){var a=(e.x-t.x)*(n.y-e.y)+(e.y-t.y)*(e.x-n.x),o=(e.x-t.x)*(i.y-e.y)+(e.y-t.y)*(e.x-i.x),r=(n.x-i.x)*(e.y-n.y)+(n.y-i.y)*(n.x-e.x),s=(n.x-i.x)*(t.y-n.y)+(n.y-i.y)*(n.x-t.x);return a*o<0&&r*s<0},c=function(e,t,n,i,a,o){var r=a-n,s=o-i,l=r*r,c=s*s,u=l+c,d=-(r*(n-e)+s*(i-t));if(d<0)return(n-e)*(n-e)+(i-t)*(i-t);if(d>u)return(a-e)*(a-e)+(o-t)*(o-t);var p=r*(i-t)-s*(n-e);return p*p/u},p={x:n.p1.x,y:n.p1.y},f={x:n.p2.x,y:n.p2.y},v=a.position,h=r.position,x=(v.x+h.x)/2,g=(v.y+h.y)/2;if(o.beginPath(),o.moveTo(v.x,v.y),o.lineTo(h.x,h.y),o.lineWidth=4,o.strokeStyle="green",o.stroke(),o.beginPath(),o.arc(x,g,2,0,2*Math.PI),o.fillStyle="yellow",o.fill(),s(p,f,v,h)){var b="aqua";c(x,g,n.p1.x,n.p1.y,n.p2.x,n.p2.y)<=n.thresh&&(new Date).getTime()-n.prev_detected.on>=300&&(d="yellow",n.people_count++,n.prev_detected={x:x,y:g,on:(new Date).getTime()},b="orange",o.beginPath(),o.arc(x,g,30,0,2*Math.PI),o.fillStyle="red",o.fill()),o.beginPath(),o.moveTo(v.x,v.y),o.lineTo(h.x,h.y),o.lineWidth=6,o.strokeStyle=b,o.stroke()}}})),o.beginPath(),o.moveTo(n.p1.x,n.p1.y),o.lineTo(n.p2.x,n.p2.y),o.lineWidth=n.thresh,o.strokeStyle=d,o.stroke(),n.is_editing_detectline&&(o.font="bold 20px sans-serif",o.fillStyle=d,o.fillText("p1",n.p1.x+n.thresh+5,n.p1.y+20),o.fillText("p2",n.p2.x+n.thresh+5,n.p2.y-15)),x.end(),requestAnimationFrame(r);case 38:case"end":return t.stop()}}),t)}))),s.apply(this,arguments)}i=!1,a.width=v,a.height=h,r()},setupCamera:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){var i,a,o,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){n.next=2;break}throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");case 2:return i=document.getElementById("video"),i.width=v,i.height=h,o=t.isMobile(),a=o?{exact:"environment"}:"user",n.next=9,navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:e,facingMode:a,width:o?void 0:v,height:o?void 0:h}});case 9:return r=n.sent,i.srcObject=r,n.abrupt("return",new Promise((function(e){i.onloadedmetadata=function(){e(i)}})));case 12:case"end":return n.stop()}}),n)})))()},loadVideo:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.setupCamera(e);case 2:return i=n.sent,i.play(),n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})))()},setupFPS:function(){x.showPanel(0),document.body.appendChild(x.dom)},setupGui:function(e,t){y.net=t,e.length>0&&(y.camera=e[0].deviceId)},onMounted:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,i,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,i=0,navigator.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){if("videoinput"===e.kind){var t={deviceId:e.deviceId,label:e.label};n.cameras.push(t),0===i&&(n.selected_camera=t),i++}}))})).catch((function(e){console.error("enumerateDevide ERROR:",e)})),e.prev_detected.on=(new Date).getTime(),e.last_reset=(new Date).toLocaleString(),t.next=7,c["c"]();case 7:return a=t.sent,document.getElementById("loading").style.display="none",document.getElementById("main").style.display="block",t.prev=10,t.next=13,e.loadVideo(n.selected_camera.deviceId);case 13:n.video=t.sent,t.next=22;break;case 16:throw t.prev=16,t.t0=t["catch"](10),o=document.getElementById("info"),o.textContent="this browser does not support video capture,or this device does not have a camera",o.style.display="block",t.t0;case 22:e.setupGui([],a),e.detectPoseInRealTime(n.video,a);case 24:case"end":return t.stop()}}),t,null,[[10,16]])})))()},isAndroid:function(){return/Android/i.test(navigator.userAgent)},isiOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},isMobile:function(){return this.isAndroid()||this.isiOS()}}},b=g,w=n("2877"),k=n("6544"),P=n.n(k),_=n("8336"),S=n("b0af"),C=n("99d9"),D=n("62ad"),I=n("a523"),V=n("cd55"),T=n("49e2"),O=n("c865"),E=n("0393"),R=n("132d"),M=n("da13"),j=n("5d23"),A=n("0fd9"),B=n("b974"),$=n("ba0d"),L=n("8654"),W=Object(w["a"])(b,r,s,!1,null,null,null),H=W.exports;P()(W,{VBtn:_["a"],VCard:S["a"],VCardActions:C["a"],VCol:D["a"],VContainer:I["a"],VExpansionPanel:V["a"],VExpansionPanelContent:T["a"],VExpansionPanelHeader:O["a"],VExpansionPanels:E["a"],VIcon:R["a"],VListItem:M["a"],VListItemContent:j["a"],VListItemSubtitle:j["b"],VListItemTitle:j["c"],VRow:A["a"],VSelect:B["a"],VSlider:$["a"],VTextField:L["a"]});var F={name:"App",components:{Camera:H},data:function(){return{drawer:!1}}},K=F,N=n("7496"),q=n("40dc"),G=n("a75b"),J=Object(w["a"])(K,a,o,!1,null,null,null),U=J.exports;P()(J,{VApp:N["a"],VAppBar:q["a"],VContent:G["a"]});var X=n("f309");i["a"].use(X["a"]);var Y=new X["a"]({});i["a"].config.productionTip=!1,new i["a"]({vuetify:Y,render:function(e){return e(U)}}).$mount("#app")},6:function(e,t){}});
//# sourceMappingURL=app.87770267.js.map